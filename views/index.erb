<div class="row">

  <!-- Main -->
  <div class="feed col-8 pl-3 py-2">

    <% if @feed.length > 0 %> <!-- If there is at least one listing -->

      <% @feed.each do |listing| %>
        <div class="listing m-3 p-4" id="listing-<%= listing.id %>">
          <div class ="listing-name">
            <a class="mb-2" href="/listing/<%= listing.id %>">
              <strong> <%= listing.name %> </strong>
            </a>
          </div>
          <div class="thumb">
            <img src='/media<%= "#{listing.photo_src.url}".gsub("/uploads/", "/uploads/thumb_") %>' class="listing-thumb">
          </div>
          <div class="listing-price mb-3">
            Price: <b>Â£<%= listing.price.floor %> per night</b>
          </div>
        </div>
      <% end %>

    <%else%> <!-- If no listing exists -->

      <div class="listing m-3 p-4">
        <div class="listing-empty">
          No listings exist. You can get a hotel, cheapskate!
        </div>
      </div>

    <%end%>

  </div>

  <!-- Sidebar -->
  <div class="col-4 pr-3 py-2">

    <% if @user %> <!-- If a user is signed in -->
    <div class="user-dashboard my-2">

      <div class="greeting mb-3">

        <h2 class="mb-3"> <strong> Hello, <%= @user.name %> </strong> </h2>

        <form action="/listing/new">
          <input class="btn btn-dark mb-2" type="submit" value="New Listing">
        </form>

        <form action="/requests">
          <input class="btn btn-dark mb-2" type="submit" value="Booking Requests">
        </form>

        <form action="/bookings">
          <input class="btn btn-dark mb-2" type="submit" value="Bookings">
        </form>

      </div>

      <div class="add-listing mt-5">
        <form action="/users/<%= session[:user_id] %>/session/destroy" method = "post">
          <input class="btn btn-dark btn-sm"  type="submit" value="Sign Out">
        </form>
      </div>
    </div>

    <% else %> <!-- If a user is not signed in -->

      <div class="sign-in my-2">
        <h5 class="mb-3"><strong>Sign in</strong> to your account</h5>
        <form action="/users/session" method="post">
          <input type="text" name="email" placeholder="Email" required>
          <input type="password" name="password" placeholder="Password" required>
          <input class="btn btn-dark" type="submit" value="Sign In">
        </form>
      </div>

      <div class="flash-notice my-5">
        <%= flash[:notice] %>
      </div>

      <div class="sign-up my-2">
        <h5 class="mb-3">Create a new account</h5>
        <form action="/users/new" method="post">
          <input type="text" name="email" placeholder="Email address" required> <br>
          <input type="password" name="password" placeholder="Password" required> <br>
          <input type="text" name="name" placeholder="Name" required> <br>
          <input class="btn btn-dark" type="submit" value="Sign Up">
        </form>
      </div>

    <% end %>
  </div>
</div>
